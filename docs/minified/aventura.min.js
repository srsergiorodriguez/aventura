class Aventura{constructor(e="en",t){this.lang="en"===e||"es"===e?e:"en",this.options={typewriterSpeed:50,style:"\n      #storygeneraldiv {\n        box-sizing: border-box;\n        margin: auto;\n        max-width: 600px;\n      }\n      #storydiv {\n        box-sizing: border-box;\n        border: solid black 1px;\n        width:100%;\n      }\n      .storyp {\n        box-sizing: border-box;\n        min-height: 40px;\n        padding: 0px 10px;\n        font-family: 'Courier New', Courier, monospace;\n        font-size: 18px;\n      }\n      .storybutton {\n        padding: 3px:\n        background: white;\n        box-shadow: none;\n        border: solid 1px;\n        margin: 0px 1em 0px 0px;\n        font-family: 'Courier New', Courier, monospace;\n        font-size: 20px;\n      }\n      .storybutton:hover {\n        color: white;\n        background: black;\n      }\n      .storyimage {\n        max-width: 100%;\n        display: block;\n        margin-left: auto;\n        margin-right: auto;\n      }\n      @media screen and (max-device-width: 500px) {\n        #storygeneraldiv {\n          max-width:100%;\n        }\n        .storyp {\n          font-size: 7vw;\n        }\n        .storybutton {\n          background: white;\n          font-size: 10vw;\n        }\n      }\n      "},t&&(this.options=Object.assign(this.options,t))}setScenes(e){let t=Object.keys(e);this.scenes=e;for(let e=0;e<t.length;e++)this.scenes[t[e]].key=t[e]}promptAdventure(){document.title=this.scenes.cover.title.toUpperCase(),alert(`${this.scenes.cover.title.toUpperCase()}\n${this.scenes.cover.subtitle}`),alert(this.scenes.intro.text),this.goToScene_prompt(this.scenes.start)}goToScene_prompt(e){const t=function(e){alert(e.end.text);let t=e.credits.text;for(let n in e.credits.authors)t+=`\n${e.credits.authors[n]}`;t+=`\n${e.credits.year}`,alert(t)},n="en"===this.lang?"or":"o",s=prompt(`${e.text}\n${e.optionA} ${n} ${e.optionB}`);if(s==e.optionA)alert(e.messageA),"end"==e.sceneA?t(this.scenes):this.goToScene_prompt(this.scenes[e.sceneA]);else if(s==e.optionB)alert(e.messageB),"end"==e.sceneB?t(this.scenes):this.goToScene_prompt(this.scenes[e.sceneB]);else if(null==s){let e="en"===this.lang?"You quit the game.":"Saliste del juego";alert(e);let t="en"===this.lang?"Do you want to try again?":"¿Quieres volver a jugar?";confirm(t)&&this.goToScene_prompt(this.scenes.start)}else{let t="en"===this.lang?`Invalid answer, you must choose either ${e.optionA} or ${e.optionB}.`:`Respuesta inválida, debes escoger entre ${e.optionA} o ${e.optionB}`;alert(t),this.goToScene_prompt(e)}}domAdventure(e){if(void 0===this.lang)return void console.log("Tura.js: Language undefined / lenguaje indefinido");document.title=this.scenes.cover.title.toUpperCase();let t=document.createElement("style");t.id="adventurestyle",t.type="text/css",t.innerHTML=this.options.style,document.getElementsByTagName("head")[0].appendChild(t);let n=document.createElement("div");if(n.id="storygeneraldiv",document.body.appendChild(n),e){let t=document.getElementById(e);document.cont.appendChild(t)}this.scenes.cover.text=`${this.scenes.cover.title.toUpperCase()}<br>${this.scenes.cover.subtitle}`,this.scenes.intro.continuation="start",this.scenes.end.continuation="credits";let s=this.scenes.credits.text;for(let e in this.scenes.credits.authors)s+=`<br>${this.scenes.credits.authors[e]}`;s+=`<br>${this.scenes.credits.year}`,this.scenes.credits.text=s,this.goToScene_dom(this.scenes.cover,"MAIN",()=>{this.continueButton(this.scenes.intro,"continue")})}goToScene_dom(e,t,n){let s=document.getElementById("storygeneraldiv"),i=document.getElementById("storydiv");i&&s.removeChild(i);let o,r,a=document.createElement("div");if(a.id="storydiv",s.appendChild(a),"MAIN"==t?(o=e.text,r=e.image):"A"==t?(o=e.messageA,r=e.imageA):"B"==t&&(o=e.messageB,r=e.imageB),null!=r){let e=document.createElement("img");e.className="storyimage",e.src=r,a.appendChild(e)}let c=document.createElement("p");if(c.className="storyp",c.innerHTML="",a.appendChild(c),o=o.replace(/\n/g,"<br>"),this.options.typewriterSpeed>0){let t=0,s=setInterval(()=>{let i=o.substring(0,t);c.innerHTML=i,++t>o.length&&(clearInterval(s),"credits"!=e.key&&n())},this.options.typewriterSpeed)}else c.innerHTML=o,"credits"!=e.key&&n()}optionButtons(e){let t=document.getElementById("storydiv"),n=document.createElement("button");n.className="storybutton",n.innerHTML=e.optionA,t.appendChild(n),n.addEventListener("click",()=>{let t="end"==e.sceneA?"continue":"options";this.goToScene_dom(e,"A",()=>{this.continueButton(this.scenes[e.sceneA],t)})});let s=document.createElement("button");s.className="storybutton",s.innerHTML=e.optionB,t.appendChild(s),s.addEventListener("click",()=>{let t="end"==e.sceneB?"continue":"options";this.goToScene_dom(e,"B",()=>{this.continueButton(this.scenes[e.sceneB],t)})})}continueButton(e,t="options"){let n=document.getElementById("storydiv"),s="en"===this.lang?"Continue":"Continuar",i=document.createElement("button");i.className="storybutton",i.innerHTML=s,n.appendChild(i),i.addEventListener("click",()=>{"continue"==t?this.goToScene_dom(e,"MAIN",()=>{this.continueButton(this.scenes[e.continuation])}):this.goToScene_dom(e,"MAIN",()=>{this.optionButtons(e)})})}setGrammar(e){this.grammar=e}developGrammar(e){if(void 0===this.lang)return void console.log("Tura.js: Language undefined / lenguaje indefinido");let t=this.selectGrammarRule(this.grammar[e]);return t=this.grammarRuleRecursion(t)}selectGrammarRule(e){return e[Math.floor(Math.random()*e.length)]}getNestedObject(e,t){return t.reduce((e,t)=>e&&"undefined"!==e[t]?e[t]:void 0,e)}defineTransformations(e){let t={capitalize:!1,allcaps:!1},n=e.match(/#[a-zA-Z1-9,]+#/g);if(!n)return t;n=(n=n[0].replace(/[#]/g,"")).match(/[A-Z]+/gi);for(let e=0;e<n.length;e++)t[n[e].toLowerCase()]=!0;return t}transformString(e,t){let n=e;return t.capitalize&&(n=n.charAt(0).toUpperCase()+n.slice(1)),t.allcaps&&(n=n.toUpperCase()),n}grammarRuleRecursion(e){const t=(e=this.setNewRule(e)).match(/<[a-zA-Z1-9.,_\/#]+>/gi);if(!t)return e;for(let n=0;n<t.length;n++){const s=this.defineTransformations(t[n]);e=e.replace(t[n],()=>{if(t[n]=t[n].replace(/[<>]/gi,""),t[n]=t[n].replace(/#[a-zA-Z1-9.,_\/]+#/g,""),t[n].search(/[.]/)>-1){const e=t[n].match(/[a-zA-Z1-9_]+/g,""),i=this.selectGrammarRule(this.getNestedObject(this.grammar,e));return this.transformString(i,s)}{const e=this.selectGrammarRule(this.grammar[t[n]]);return this.transformString(e,s)}})}return this.grammarRuleRecursion(e)}setNewRule(e){let t=e,n=t.match(/\$[a-zA-Z1-9_]+\$<[a-zA-Z1-9:,_]+>/g);if(n)for(;n.length;){let e=n.pop();t=t.replace(e,"");const s=e.match(/\$[a-zA-Z1-9_]+\$/gi)[0].replace(/\$/g,""),i=e.match(/<[a-zA-Z1-9:,_]+>/gi)[0].match(/[a-zA-Z1-9_]+:[a-zA-Z1-9_]+/gi),o=i.map(e=>e.replace(/:[a-zA-Z1-9,_]+/,"")),r=i.map(e=>e.replace(/[a-zA-Z1-9]+:/,""));if(this.grammar[s]=this.grammar[s]?this.grammar[s]:{},o&&r)for(let e=0;e<o.length;e++)this.grammar[s][o[e]]=[this.selectGrammarRule(this.grammar[r[e]])]}return t}}